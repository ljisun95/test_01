<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>Snake Game</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      background: #111; color: #f5f5f5; font-family: system-ui;
      display: flex; flex-direction: column; align-items: center;
      padding-top: 40px;
    }
    h1 { margin-bottom: 10px; }
    .info { margin-bottom: 20px; color: #ccc; text-align: center; }
    #game { background: #222; border: 3px solid #4caf50; }
    #score-board { margin-top: 12px; }
    #score-board span { color: #4caf50; font-weight: bold; }
    #message { margin-top: 10px; color: #ffeb3b; }
    .btn {
      margin-top: 16px; padding: 8px 16px; border-radius: 4px;
      background: #4caf50; border: none; cursor: pointer; font-weight: 600;
    }
    .btn:hover { background: #66bb6a; }
  </style>
</head>
<body>
  <h1>Snake Game</h1>
  <div class="info">방향키로 조작하세요. 벽을 넘어가면 반대편으로 나옵니다!</div>

  <canvas id="game" width="400" height="400"></canvas>

  <div id="score-board">점수: <span id="score">0</span></div>
  <div id="message">스페이스바 또는 버튼으로 시작하세요.</div>
  <button class="btn" id="restart-btn">게임 시작 / 다시 시작</button>

  <script>
    const canvas = document.getElementById("game");
    const ctx = canvas.getContext("2d");

    const tileSize = 20;
    const tileCount = canvas.width / tileSize;

    let snake = [];
    let direction = { x: 1, y: 0 };
    let nextDirection = { x: 1, y: 0 };
    let food = { x: 10, y: 10 };
    let score = 0;
    let gameLoop = null;
    let isGameOver = false;
    let isStarted = false;

    const scoreEl = document.getElementById("score");
    const messageEl = document.getElementById("message");
    const restartBtn = document.getElementById("restart-btn");

    function initGame() {
      snake = [
        { x: 8, y: 10 },
        { x: 7, y: 10 },
        { x: 6, y: 10 }
      ];
      direction = { x: 1, y: 0 };
      nextDirection = { x: 1, y: 0 };
      score = 0;
      isGameOver = false;
      isStarted = true;
      scoreEl.textContent = score;
      messageEl.textContent = "게임 중...";

      placeFood();
      if (gameLoop) clearInterval(gameLoop);
      gameLoop = setInterval(update, 120);
      draw();
    }

    function placeFood() {
      let newFood;
      while (true) {
        newFood = {
          x: Math.floor(Math.random() * tileCount),
          y: Math.floor(Math.random() * tileCount)
        };
        if (!snake.some(seg => seg.x === newFood.x && seg.y === newFood.y)) break;
      }
      food = newFood;
    }

    function update() {
      if (isGameOver) return;

      direction = { ...nextDirection };

      const head = { ...snake[0] };
      head.x += direction.x;
      head.y += direction.y;

      // ⭐ 화면 넘어가면 반대편으로 이동
      head.x = (head.x + tileCount) % tileCount;
      head.y = (head.y + tileCount) % tileCount;

      // 자기 몸과 충돌 체크
      if (snake.some(seg => seg.x === head.x && seg.y === head.y)) {
        endGame();
        return;
      }

      snake.unshift(head);

      if (head.x === food.x && head.y === food.y) {
        score += 10;
        scoreEl.textContent = score;
        placeFood();
      } else {
        snake.pop();
      }

      draw();
    }

    function draw() {
      ctx.fillStyle = "#111";
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      ctx.fillStyle = "#ff5252";
      ctx.fillRect(food.x * tileSize, food.y * tileSize, tileSize, tileSize);

      snake.forEach((seg, index) => {
        ctx.fillStyle = index === 0 ? "#4caf50" : "#81c784";
        ctx.fillRect(seg.x * tileSize, seg.y * tileSize, tileSize, tileSize);
      });
    }

    function endGame() {
      isGameOver = true;
      isStarted = false;
      clearInterval(gameLoop);
      messageEl.textContent = "게임 오버! 스페이스바 또는 버튼으로 다시 시작하세요.";
    }

    document.addEventListener("keydown", (e) => {
      if (e.code === "Space") {
        initGame();
        return;
      }
      if (!isStarted || isGameOver) return;

      switch (e.key) {
        case "ArrowUp":
          if (direction.y !== 1) nextDirection = { x: 0, y: -1 };
          break;
        case "ArrowDown":
          if (direction.y !== -1) nextDirection = { x: 0, y: 1 };
          break;
        case "ArrowLeft":
          if (direction.x !== 1) nextDirection = { x: -1, y: 0 };
          break;
        case "ArrowRight":
          if (direction.x !== -1) nextDirection = { x: 1, y: 0 };
          break;
      }
    });

    restartBtn.addEventListener("click", initGame);

    draw();
  </script>
</body>
</html>
